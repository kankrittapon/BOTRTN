# BOTRTN Runner

เครื่องมือสคริปต์ Playwright สำหรับเปิดเบราว์เซอร์ (Chrome หรือ Microsoft Edge) พร้อมล็อกอินอัตโนมัติและจับภาพหน้าจอ โดยมีหน้าตั้งค่าก่อนเริ่มทำงาน

## วิธีใช้งานพื้นฐาน

1. ติดตั้ง .NET 10 preview ตามที่โครงการนี้ต้องการ
2. รันคำสั่ง:
   ```powershell
   dotnet run --project src/Runner/Runner.csproj
   ```
3. หน้าตั้งค่าจะเปิดขึ้นมา ให้กำหนดค่าต่าง ๆ (โปรไฟล์ + Task) แล้วกด **บันทึกและเริ่มทำงาน**  
   - หาก Task ใดล็อกอินไม่สำเร็จ โปรแกรมจะแจ้งเตือนพร้อมกลับมาหน้าตั้งค่าให้อัตโนมัติ

## การตั้งค่า Browser (Chrome / Edge)

- เลือกได้เฉพาะ **Google Chrome** หรือ **Microsoft Edge** ซึ่งจะใช้ตัวติดตั้งในเครื่องปัจจุบัน
- โหมด **Run headless** ใช้สำหรับรันเบราว์เซอร์แบบไม่โชว์หน้าต่าง (เหมาะกับเครื่องเซิร์ฟเวอร์)
- `Screenshot path` กำหนดไฟล์ภาพที่ระบบจะบันทึกหลังจบงาน
- `Timeout (ms)` ใช้สำหรับกำหนดเวลารอโหลดหน้า/องค์ประกอบต่าง ๆ ของ Playwright

## โปรไฟล์เบราว์เซอร์ (Browser Profiles)

- สร้างได้หลายโปรไฟล์เพื่อแยกโฟลเดอร์ session / credential และ proxy กันอย่างอิสระ
- ปุ่ม **เพิ่ม / ลบ** สำหรับจัดการจำนวนโปรไฟล์ (ต้องเหลืออย่างน้อย 1 โปรไฟล์เสมอ)
- การเปลี่ยนชื่อโปรไฟล์จะสะท้อนไปที่ Task ที่ใช้โปรไฟล์นั้นโดยอัตโนมัติ
- ตั้งค่า Credential/Proxy สำหรับโปรไฟล์ได้ที่ส่วนนี้ (Task จะเลือกว่าจะใช้ credential หรือไม่ในขั้นตอน Task)

## Credentials และ Proxy (ต่อโปรไฟล์)

- ช่อง **Username / Password** ใช้เก็บ credential ที่จะส่งให้ระบบล็อกอิน; หากตั้งให้ไม่ใช้ credential ช่องนี้จะถูกปิดการใช้งาน
- ยังสามารถ override credential ด้วยตัวแปรสภาพแวดล้อม (`APP_USER` / `APP_PASS`) ได้เหมือนเดิม
- Proxy ของแต่ละโปรไฟล์เปิด/ปิดได้แยกกัน (ถ้า proxy ต้อง auth ให้กรอก Username/Password; หากไม่ต้อง auth ปล่อยว่างได้)

## Task Scheduling

- **Task** คือแผนการรันงานต่อหนึ่งโปรไฟล์ สามารถสร้างหลาย Task ได้และจะรันตามลำดับที่แสดง
- ตัวเลือกสำคัญใน Task:
  - `ใช้โปรไฟล์` เลือกโปรไฟล์ที่จะใช้ตอนรัน
  - `Run mode`
    - `Immediate` เริ่มทำงานทันที
    - `Delay` กำหนดเวลาหน่วงเป็นนาที (ตัวเลข > 0)
    - `DailyTime` ตั้งเวลาในแต่ละวัน (เลือกทำซ้ำทุกวันหรือไม่ก็ได้)
  - `ใช้ credential สำหรับล็อกอิน` เปิด/ปิดการเรียก login flow
  - `Target URL override` / `Screenshot path override` กำหนดค่าเฉพาะ Task (ถ้าว่างจะ fallback ไปใช้ค่ากลาง)
- ปุ่ม **เพิ่ม / คัดลอก / ลบ** ใช้จัดการ Task ได้ตามต้องการ
- หลังจากกด "บันทึกและเริ่มทำงาน" หน้าต่างจะยังคงเปิด และแถบสถานะจะแสดงความคืบหน้าของแต่ละ Task (รอเวลา/กำลังทำงาน/สำเร็จ/ผิดพลาด)

## ไฟล์ตั้งค่า `UserSettings.json`

- ระบบจะสร้างไฟล์นี้ไว้ที่เดียวกับตัวโปรแกรม (คัดลอกไป output ทุกครั้งที่ build)
- โครงสร้างหลัก:
  ```json
  {
    "targetUrl": "https://www.facebook.com/",
    "browser": "chrome",
    "selectedProfile": "Default",
    "profiles": [
      {
        "name": "Default",
        "userDataDirName": "botRTN_Default",
        "credentials": {
          "user": "",
          "pass": ""
        },
        "proxy": {
          "enabled": false,
          "server": "",
          "username": "",
          "password": ""
        }
      }
    ],
    "tasks": [
      {
        "name": "Task 1",
        "profileName": "Default",
        "enabled": true,
        "runMode": 0,
        "useCredentials": true
      }
    ]
  }
  ```
- หากแก้ไขไฟล์ด้วยตัวเอง แนะนำให้ปิดโปรแกรมก่อนแล้วเปิดใหม่เพื่อให้ข้อมูลโหลดล่าสุด

## หมายเหตุเพิ่มเติม

- เมื่อระบบล็อกอินพบข้อความผิดพลาดที่รู้จัก (เช่น Email/Password ไม่ถูกต้อง) จะเตือนบนคอนโซล/กล่องข้อความและพากลับไปหน้าตั้งค่าเพื่อแก้ไข
- ภาพหน้าจอที่บันทึกจะถูกเติมชื่อโปรไฟล์และ Task ต่อท้ายไฟล์โดยอัตโนมัติ (`screenshot_<profile>_<task>.png`)
- ระบบล็อกอินยังรองรับ 2FA โดยจะหยุดรอให้กรอกเองในหน้าต่างเบราว์เซอร์เมื่อพบช่อง 2FA
- หากต้องเปลี่ยน selector สำหรับระบบล็อกอิน ปรับในส่วน `Login` ของ `UserSettings.json`
- Environment Variables สามารถใช้ override Credentials ได้กรณีต้องการซ่อนข้อมูลในไฟล์
